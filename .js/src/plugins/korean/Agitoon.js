var t=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{a(r.next(t))}catch(t){o(t)}}function u(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}a((r=r.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(a){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,r=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){s=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){s.label=u[1];break}if(6===u[0]&&s.label<i[1]){s.label=i[1],i=u;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(u);break}i[2]&&s.ops.pop(),s.trys.pop();continue}u=e.call(t,s)}catch(t){u=[6,t],r=0}finally{n=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@libs/fetch"),i=require("cheerio"),o=n(require("qs")),s=function(){function n(){this.id="agit.xyz",this.name="Agitoon",this.icon="src/kr/agitoon/icon.png",this.site="https://agit664.xyz",this.version="3.1.0"}return n.prototype.checkUrl=function(){return t(this,void 0,void 0,(function(){var t;return e(this,(function(e){switch(e.label){case 0:return n.url?[3,2]:[4,(0,r.fetchApi)(this.site)];case 1:(t=e.sent()).ok?n.url=t.url.replace(/\/$/,""):n.url=this.site,e.label=2;case 2:return[2]}}))}))},n.prototype.popularNovels=function(i,s){return t(this,arguments,void 0,(function(t,i){var s,u,a,c,l=i.showLatestNovels;return e(this,(function(e){switch(e.label){case 0:return[4,this.checkUrl()];case 1:return e.sent(),[4,(0,r.fetchApi)(n.url+"/novel/index.update.php",{headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",body:o.default.stringify({mode:"get_data_novel_list_p",novel_menu:l?"1":"3",np_day:(new Date).getDay(),np_rank:"1",np_distributor:"0",np_genre:"00",np_order:"1",np_genre_ex_1:"00",np_genre_ex_2:"00",list_limit:20*(t-1),is_query_first:1==t})})];case 2:if(!(s=e.sent()).ok)throw new Error("Failed to get popular novels: (".concat(s.status,": ").concat(s.statusText,") (try to open in webview)"));return[4,s.json()];case 3:return u=e.sent(),a=[],null===(c=null==u?void 0:u.list)||void 0===c||c.forEach((function(t){return a.push({name:t.wr_subject,cover:n.url+t.np_dir+"/thumbnail/"+t.np_thumbnail,path:t.wr_id})})),[2,a]}}))}))},n.prototype.parseNovel=function(s){return t(this,void 0,void 0,(function(){var t,u,a,c,l,h,p;return e(this,(function(e){switch(e.label){case 0:return[4,this.checkUrl()];case 1:return e.sent(),[4,(0,r.fetchApi)(this.resolveUrl(s,!0)).then((function(t){return t.text()}))];case 2:return t=e.sent(),u=(0,i.load)(t,{decodeEntities:!1}),(a={path:s,name:u("h5.pt-2").text(),cover:u("div.col-5.pr-0.pl-0 img").attr("src"),summary:u(".pt-1.mt-1.pb-1.mb-1").text()}).author=u(".post-item-list-cate-v").first().text().split(" : ")[1],(c=u(".col-7 > .post-item-list-cate > span").map((function(t,e){return u(e).text().trim()})).get()).length&&(a.genres=c.join(", ")),l=[],[4,(0,r.fetchApi)(n.url+"/novel/list.update.php",{headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",body:o.default.stringify({mode:"get_data_novel_list_c",wr_id_p:s,page_no:"1",cnt_list:"10000",order_type:"Asc"})})];case 3:return[4,e.sent().json()];case 4:return h=e.sent(),null===(p=null==h?void 0:h.list)||void 0===p||p.forEach((function(t){return l.push({name:t.wr_subject,path:t.wr_id+"/2",releaseTime:t.wr_datetime})})),a.chapters=l,[2,a]}}))}))},n.prototype.parseChapter=function(n){return t(this,void 0,void 0,(function(){var t,o;return e(this,(function(e){switch(e.label){case 0:return[4,this.checkUrl()];case 1:return e.sent(),[4,(0,r.fetchApi)(this.resolveUrl(n)).then((function(t){return t.text()}))];case 2:return t=e.sent(),o=(0,i.load)(t),[2,(o("#id_wr_content").html()||"").replace("팝업메뉴는 빈공간을 더치하거나 스크룰시 사라집니다","").trim()]}}))}))},n.prototype.searchNovels=function(i,s){return t(this,void 0,void 0,(function(){var t,u,a;return e(this,(function(e){switch(e.label){case 0:return 1!==s?[2,[]]:[4,this.checkUrl()];case 1:return e.sent(),[4,(0,r.fetchApi)(n.url+"/novel/search.php",{headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",body:o.default.stringify({mode:"get_data_novel_list_p_sch",search_novel:i,list_limit:0})})];case 2:return[4,e.sent().json()];case 3:return t=e.sent(),u=[],null===(a=null==t?void 0:t.list)||void 0===a||a.forEach((function(t){return u.push({name:t.wr_subject,cover:n.url+"/"+t.np_dir+"/thumbnail/"+t.np_thumbnail,path:t.wr_id})})),[2,u]}}))}))},n.prototype.resolveUrl=function(t,e){return n.url||(0,r.fetchApi)(this.site).then((function(t){return n.url=t.url.replace(/\/$/,"")})),(n.url?n.url:this.site)+(e?"/novel/list/":"/novel/view/")+t},n}();exports.default=new s;