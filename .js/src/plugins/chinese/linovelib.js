var t=this&&this.__awaiter||function(t,e,a,n){return new(a||(a=Promise))((function(r,o){function i(t){try{c(n.next(t))}catch(t){o(t)}}function l(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(i,l)}c((n=n.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var a,n,r,o,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(c){return function(l){if(a)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(a=1,n&&(r=2&l[0]?n.return:l[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,l[1])).done)return r;switch(n=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,n=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){i.label=l[1];break}if(6===l[0]&&i.label<r[1]){i.label=r[1],r=l;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(l);break}r[2]&&i.ops.pop(),i.trys.pop();continue}l=e.call(t,i)}catch(t){l=[6,t],n=0}finally{a=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}};Object.defineProperty(exports,"__esModule",{value:!0});var a=require("cheerio"),n=require("@libs/fetch"),r=require("@libs/filterInputs"),o=require("@libs/novelStatus"),i=function(){function i(){this.id="linovelib",this.name="Linovelib",this.icon="src/cn/linovelib/icon.png",this.site="https://www.bilinovel.com",this.version="1.1.2",this.filters={rank:{label:"排行榜",value:"monthvisit",options:[{label:"月点击榜",value:"monthvisit"},{label:"周点击榜",value:"weekvisit"},{label:"月推荐榜",value:"monthvote"},{label:"周推荐榜",value:"weekvote"},{label:"月鲜花榜",value:"monthflower"},{label:"周鲜花榜",value:"weekflower"},{label:"月鸡蛋榜",value:"monthegg"},{label:"周鸡蛋榜",value:"weekegg"},{label:"最近更新",value:"lastupdate"},{label:"最新入库",value:"postdate"},{label:"收藏榜",value:"goodnum"},{label:"新书榜",value:"newhot"}],type:r.FilterTypes.Picker}}}return i.prototype.popularNovels=function(r,o){return t(this,arguments,void 0,(function(t,r){var o,i,l,c,s,u=r.showLatestNovels,h=r.filters;return e(this,(function(e){switch(e.label){case 0:return o=u?"lastupdate":h.rank.value,i="".concat(this.site,"/top/").concat(o,"/").concat(t,".html"),[4,(0,n.fetchText)(i)];case 1:if(""===(l=e.sent()))throw Error("无法获取小说列表，请检查网络");return c=(0,a.load)(l),s=[],c(".module-rank-booklist .book-layout").each((function(t,e){var a=c(e).attr("href"),n=c(e).find(".book-title").text(),r=c(e).find("div.book-cover > img").attr("data-src");if(a){var o={name:n,cover:r,path:a};s.push(o)}})),[2,s]}}))}))},i.prototype.parseNovel=function(r){return t(this,void 0,void 0,(function(){var t,i,l,c,s,u,h,v,f,p,b,d,m,g;return e(this,(function(e){switch(e.label){case 0:return t=this.site+r,[4,(0,n.fetchText)(t)];case 1:if(""===(i=e.sent()))throw Error("无法获取小说内容，请检查网络");return l=(0,a.load)(i),(c={path:r,chapters:[],name:l("#bookDetailWrapper .book-title").text()}).cover=l("#bookDetailWrapper img.book-cover").attr("src"),c.summary=l("#bookSummary content").text(),c.author=l("#bookDetailWrapper .book-rand-a a").text(),s=l("#bookDetailWrapper .book-meta").text(),c.status=s.includes("完结")?o.NovelStatus.Completed:o.NovelStatus.Ongoing,c.genres=l(".tag-small.red").children("a").map((function(t,e){return l(e).text()})).toArray().join(","),u=[],h=/\/(\d+)\.html/,v=null===(g=t.match(h))||void 0===g?void 0:g[1],f=this.site+l("#btnReadBook").attr("href"),[4,(0,n.fetchText)(f)];case 2:return p=e.sent(),(b=(0,a.load)(p))("#volumes .chapter-li:not(.volume-cover)").each((function(t,e){if(b(e).hasClass("chapter-bar"))d=b(e).text();else{var a=b(e).find(".chapter-li-a").attr("href"),n=null==a?void 0:a.match(h);n?m=+n[1]:m++;var r="/novel/".concat(v,"/").concat(m,".html"),o=d+" — "+b(e).find(".chapter-index").text().trim();m&&u.push({name:o,releaseTime:null,path:r})}})),c.chapters=u,[2,c]}}))}))},i.prototype.parseChapter=function(r){return t(this,void 0,void 0,(function(){var o,i,l,c,s,u,h,v,f,p,b,d,m=this;return e(this,(function(g){switch(g.label){case 0:i="",s="",u=1,h={"“":"「","”":"」","‘":"『","’":"』","":"的","":"一","":"是","":"了","":"我","":"不","":"人","":"在","":"他","":"有","":"这","":"个","":"上","":"们","":"来","":"到","":"时","":"大","":"地","":"为","":"子","":"中","":"你","":"说","":"生","":"国","":"年","":"着","":"就","":"那","":"和","":"要","":"她","":"出","":"也","":"得","":"里","":"后","":"自","":"以","":"会","":"家","":"可","":"下","":"而","":"过","":"天","":"去","":"能","":"对","":"小","":"多","":"然","":"于","":"心","":"学","":"么","":"之","":"都","":"好","":"看","":"起","":"发","":"当","":"没","":"成","":"只","":"如","":"事","":"把","":"还","":"用","":"第","":"样","":"道","":"想","":"作","":"种","":"开","":"美","":"乳","":"阴","":"液","":"茎","":"欲","":"呻","":"肉","":"交","":"性","":"胸","":"私","":"穴","":"淫","":"臀","":"舔","":"射","":"脱","":"裸","":"骚","":"唇"},v=function(a){return t(m,void 0,void 0,(function(){var n=this;return e(this,(function(r){switch(r.label){case 0:return[4,function(){return t(n,void 0,void 0,(function(){return e(this,(function(t){return a("#acontentz .adsbygoogle").remove(),a("#acontentz script").remove(),a("#acontentz img.imagecontent").each((function(t,e){var n=a(e).attr("data-src")||a(e).attr("src");n&&a(e).attr("src",n).removeAttr("data-src").removeClass("lazyload")})),s=(s=a("#acontentz").html()||"").replace(/./g,(function(t){return h[t]||t})),[2,Promise.resolve()]}))}))}()];case 1:return r.sent(),o=a("#atitle + h3").text()+" — "+a("#atitle").text(),""===i&&(i="<h2>"+o+"</h2>"),i+=s,[2]}}))}))},f=function(r){return t(m,void 0,void 0,(function(){var t,o,i;return e(this,(function(e){switch(e.label){case 0:return t={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"zh-CN,zh;q=0.9,zh-TW;q=0.8,zh-HK;q=0.7,en;q=0.6,en-GB;q=0.5,en-US;q=0.4","Cache-Control":"no-cache"},[4,(0,n.fetchText)(r,{headers:t})];case 1:return o=e.sent(),i=(0,a.load)(o),[4,v(i)];case 2:return e.sent(),c="下一页"===i("#footlink a:last").text()||"下一頁"===i("#footlink a:last").text(),[2,{pageCheerio:i,pageHasNextPage:c}]}}))}))},p=this.site+r,b=p,g.label=1;case 1:return[4,f(p)];case 2:d=g.sent(),!0===(l=d.pageHasNextPage)&&(u++,p=b.replace(/\.html/gi,"_".concat(u)+".html")),g.label=3;case 3:if(!0===l)return[3,1];g.label=4;case 4:return[2,i]}}))}))},i.prototype.searchNovels=function(r,o){return t(this,void 0,void 0,(function(){var t,i,l,c;return e(this,(function(e){switch(e.label){case 0:return t="".concat(this.site,"/search/").concat(encodeURI(r),"_").concat(o,".html"),[4,(0,n.fetchText)(t)];case 1:if(""===(i=e.sent()))throw Error("无法获取搜索结果，请检查网络");return l=(0,a.load)(i),c=[],l(".book-ol .book-layout").each((function(t,e){var a=l(e).attr("href"),n=l(e).find(".book-title").text(),r=l(e).find("div.book-cover > img").attr("data-src");a&&c.push({name:n,path:a,cover:r})})),[2,c]}}))}))},i}();exports.default=new i;